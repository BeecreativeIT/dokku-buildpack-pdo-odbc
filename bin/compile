#!/usr/bin/env bash
set -e

BUILD_DIR="$1"

echo "-----> Installing PDO_ODBC for Heroku/Dokku PHP buildpack"

PHP_VERSION=$("$BUILD_DIR/.apt/usr/bin/php" -r "echo PHP_MAJOR_VERSION.'.'.PHP_MINOR_VERSION;")

echo "Detected PHP version: $PHP_VERSION"

mkdir -p /tmp/php-src
cd /tmp/php-src

curl -sL https://www.php.net/distributions/php-${PHP_VERSION}.tar.gz -o php-src.tar.gz
tar xzf php-src.tar.gz

# Copia i sorgenti dell'estensione PDO_ODBC dentro la dir delle estensioni custom
EXT_DIR="$BUILD_DIR/.heroku/php/ext/pdo_odbc"
mkdir -p "$EXT_DIR"
cp -R php-*/ext/pdo_odbc/* "$EXT_DIR/"

echo "-----> PDO_ODBC extension source installed."
echo "NOTE: The PHP buildpack will compile this extension automatically."
